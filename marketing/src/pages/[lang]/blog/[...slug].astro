---
import { getCollection, type CollectionEntry } from 'astro:content';
import BlogLayout from '../../../layouts/BlogLayout.astro';
import { getNonDefaultLocales, type Locale } from '../../../i18n';

export async function getStaticPaths() {
  const paths = [];
  for (const lang of getNonDefaultLocales()) {
    const posts = await getCollection('blog', ({ data }: { data: { lang: string } }) => data.lang === lang);
    for (const post of posts) {
      paths.push({
        params: {
          lang,
          slug: post.slug.replace(`${lang}/`, '')
        },
        props: { post },
      });
    }
  }
  return paths;
}

type Props = { post: CollectionEntry<'blog'> };
const { post } = Astro.props as Props;
const { Content, headings } = await post.render();
---

<BlogLayout post={post} headings={headings}>
  <Content />
</BlogLayout>
